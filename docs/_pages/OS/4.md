---
title: "스레드(Thread) 이해"
permalink: /OS/4
tags:
    - OS
date: "2024-08-24"
thumbnail: "/assets/img/thumbnail/OS.webp"
---

# 스레드(Thread) 란?
---

스레드는 프로세스 내에서 실행되는 흐름의 단위입니다.

일반적인 프로그램은 일반적으로 단일 스레드로 실행되지만 디자인 및 요구 사항에 따라 여러 스레드를 사용하여 다양한 작업을 동시에 수행할 수도 있습니다. 
이 접근 방식을 `멀티스레드(multi-thread)`라고 합니다.

## 스레드의 구조
---

프로세스 내의 모든 스레드는 코드, 데이터 및 운영 체제 리소스(예: 열린 파일 및 신호)와 같은 공통 리소스를 공유합니다.

프로그램의 각 스레드에는 고유한 스레드 ID, 프로그램 카운터(PC), 레지스터 집합 및 스택이 있습니다. 

스레드마다 고유한 자원(PC, 레지스터 집합, 스택)을 가지고 있는 이유는 독립적인 함수 호출 및 실행 흐름을 추가하기 위한 것입니다.

이를 통해 서로 다른 스레드가 서로 간섭하지 않고 동시에 다양한 작업을 수행할 수 있습니다.

![Thread](/assets/img/posts/OS/4/1.webp "Thread"){:class="img-lg"}

## 프로세스와 스레드의 주요 차이점
---

주요 차이점은 동일한 프로세스 내에서 스레드는 동일한 메모리 공간을 공유하는 반면 프로세스는 별도의 메모리 공간에서 실행된다는 것입니다.

이 공유 메모리 공간을 통해 스레드는 더 쉽게 통신할 수 있지만 한 스레드가 다른 스레드의 메모리 공간을 덮어쓸 경우 문제가 발생할 수 있습니다.

## 스레드 사용의 장점과 단점
---

### 스레용 사용의 이점
1. 사용자 응답성 증가
    - 프로세스를 여러 스레드로 분할하면 일부 스레드가 지연되더라도 다른 스레드는 계속 작동하여 애플리케이션의 응답을 유지할 수 있습니다.
2. 다중 처리로 성능 향상
    - 스레드를 사용하면 멀티 코어 프로세서에서 작업을 병렬로 실행할 수 있습니다. 여러 스레드가 서로 다른 CPU 코어에서 동시에 처리될 수 있으므로 이로 인해 성능이 크게 향상될 수 있습니다.
3. 효율적인 자원 활용
    - 스레드는 프로세스 내에서 리소스를 공유하므로 여러 프로세스를 사용하는 것에 비해 추가 리소스 할당 및 문맥 교환(Context switch) 비용이 줄어듭니다.
4. 통신이 쉬움
    - 특별한 기술(IPC)이 필요한 프로세스 간 통신과 달리 스레드는 동일한 메모리 공간을 공유하기 때문에 쉽게 데이터를 교환할 수 있습니다.

### 스레드 사용의 단점
1. 불안정 가능성
    - 스레드는 동일한 메모리 공간을 공유하기 때문에 한 스레드가 실수로 다른 스레드에서 사용하는 메모리를 덮어쓸 수 있으며 이로 인해 예측할 수 없는 동작, 충돌 또는 보안 취약성이 발생할 수 있습니다.
2. 동기화의 복잡성
    - 여러 스레드를 관리하려면 개발 및 디버깅 프로세스를 복잡하게 만들 수 있는 `경쟁 상태(race condition)`, `교착 상태(deadlock)`등의 문제를 피하기 위해 신중한 `동기화`가 필요합니다.

## 스레드 유형
---

스레드는 운영 체제에 따라 다양한 방식으로 구현될 수 있지만 일반적으로 세 가지 범주로 분류됩니다.

### 1. 사용자 수준 스레드 (User-Level Thread)
사용자 스레드는 커널 영역의 상위에서 지원되며 일반적으로 사용자 수준의 라이브러리를 통해 구현됩니다.
이 경우 커널은 스레드의 존재를 인식하지 못하기 때문에 커널의 개입을 받지 않습니다.

다수의 사용자 수준 스레드가 커널 수준 스레드 한개에 매핑되므로 `다대일(n:1)` 스레드 매핑이라고 합니다.

![User-Level Thread](/assets/img/posts/OS/4/2.webp "User-Level Thread"){:class="img-lg"}

- 장점
    - 사용자 영역에서 생성 및 관리되므로 속도가 빠릅니다.
    - 커널의 개입을 받지 않기 때문에 이식성(portability)이 높습니다. (모든 운영체제에서 실행할 수 있음)

- 단점
    - 커널에서 스레드가 하나라고 판단하기 때문에 하나의 스레드가 중단되면 나머지 모든 스레드 역시 중단됩니다.

### 2. 커널 수준 스레드 (Kernel-Level Thread)
커널 수준 스레드는 운영체제가 지원하는 스레드 기능으로 구현되며, 커널이 스레드의 생성 및 스케줄링 등을 관리합니다.

사용자수준 스레드와 커널 수준 스레드가 `일대일(1:1)`로 매핑됩니다. 따라서 사용자 수준 스레드를 생성하면 이에 대응하는 커널 스레드를 자동으로 생성합니다.

![Kernel-Level Thread](/assets/img/posts/OS/4/3.webp "Kernel-Level Thread"){:class="img-lg"}

- 장점
    - 커널이 각 스레드를 개별적으로 관리하기 때문에 프로세스 내 스레드들이 병행으로 수행이 가능합니다.
    - 그렇기 때문에 하나의 스레드가 중단되도 다른 스레드는 계속 수행이 가능합니다.

- 단점
    - 사용자 스레드보다 생성및 관리 속도가 느립니다.

### 3. 혼합형 스레드
사용자 수준 스레드와 커널 수준 스레드를 혼합한 구조입니다. 이는 사용자 수준 스레드와 커널수준 스레드의 단점을 극복한 방법입니다.

사용자 수준 쓰레드는 커널 수준 쓰레드와 비슷한 경량 프로세스에 다대다로 매핑되고, 경량 프로세스는 커널 수준 쓰레드와 일대일로 매핑됩니다. 결국 다수의 사용자 수준 쓰레드에 다수의 커널 쓰레드가 `다대다(n:m)`로 매핑됩니다.

![Mixed Thread](/assets/img/posts/OS/4/3.webp "Mixed Thread"){:class="img-lg"}

- 장점
    - 프로세스 내 스레드들이 병행으로 수행이 가능합니다
    - `스레드 풀링(thread pooling)` 기법을 통해 일대일 스레드 매핑에서의 오버헤드를 줄여줍니다.

- 단점
    - 구현및 관리가 복잡합니다.

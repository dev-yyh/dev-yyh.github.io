---
title: "문맥 교환(Context switch) 이해"
permalink: /OS/3
tags:
    - OS
date: "2024-08-22"
thumbnail: "/assets/img/thumbnail/OS.webp"
---

`문맥(context)`은 프로세스의 상태 정보를 의미합니다.

`문맥교환(context switch)`은 프로세스의 상태 정보를 교환하는 작업입니다.

문맥 교환은 여러 프로세스가 단일 CPU 리소스를 공유하고 활용할 수 있도록 합니다.

# 문맥 교환 (Context switch)이란?
---

문맥 교환에는 하나의 프로세스가 CPU를 사용 중인 상태에서 다른 프로세스가 CPU를 사용하도록 하기 위해 이전의 프로세스의 상태를 보관하고 또 다른 프로세스의 정보를 읽어 레지스터에 적재하는 작업이 포함됩니다.
프로세스의 상태는 `프로세스 제어 블록(PCB)`에 보관됩니다.

이를 통해 시스템은 여러 프로세스를 빠르게 전환하여 동시에 여러 프로세스를 실행할 수 있습니다.

이 전환은 너무 빨라서 단일 CPU에서도 병렬 처리라는 착각을 불러일으킵니다.

![Context switch](/assets/img/posts/OS/3/1.webp "Context switch"){:class="img-lg"}

## 멀티태스킹 (Multitasking)에서 문맥 교환의 역할
---

멀티태스킹(=멀티프로세싱)은 문맥 교환을 통해 가능해집니다.
- 멀티태스킹 (Multitasking): 다수의 프로세스가 하나의 CPU 자원을 나누어 사용하는 것

하나의 CPU에서 여러 개의 프로세스가 동시에 수행되는 것처럼 보이는 이유는 문맥 교환이 빠르게 일어나고 있기 때문입니다.

문맥 교환 중에는 다른 작업을 할 수 없기 때문에 이 시간을 `오버헤드`라고 합니다.

## 오버헤드 해결 방안
---

문맥 교환 중에는 실제 처리가 발생하지 않습니다. 
CPU는 단순히 프로세스 상태를 저장하고 로드하는데, 이는 특히 문맥 교환이 자주 발생하는 경우 성능에 영향을 줄 수 있습니다.

오버헤드 해결 방안은 다음과 같습니다.
1. 다중 프로그래밍 감소
    - 동시에 실행되는 프로세스 수를 제한하여 컨텍스트 전환 빈도를 줄일 수 있습니다.
2. 스택 기반 처리 (Stack-Oriented)
    - 스택 기반 처리를 사용하는 시스템에서는 스택 포인터 레지스터를 변경하여 문맥 교환을 수행할 수 있으며 이는 더 효율적입니다.
3. 스레드를 사용하여 문맥 교환 부하 최소화
    - 스레드는 프로세스보다 가볍기 때문에 전환하는 데 더 적은 컨텍스트가 필요하므로 오버헤드가 줄어듭니다.

## 문맥 교환이 일어나는 시점
---

문맥 교환이 일어나는 시점은 다음과 같습니다.
- **멀티 태스킹** 
    - 멀티태스킹 환경에서 스케줄러는 한 프로세스가 다른 프로세스에 CPU를 양보해야 할 때 프로세스를 전환할 수 있습니다. 선점형 시스템에서는 스케줄러가 프로세스를 중단하여 다른 프로세스로 전환할 수 있습니다.
- **인터럽트 처리**
    -  인터럽트가 발생하면 하드웨어는 자동으로 컨텍스트의 일부를 전환합니다. 이 전환은 일반적으로 인터럽트 처리에 필요한 시간을 줄이기 위해 최소화됩니다.
- **사용자 및 커널 모드 전환**
    - 운영 체제에서 사용자 모드와 커널 모드 사이의 전환이 필요할 때 문맥 교환이 발생할 수 있습니다.